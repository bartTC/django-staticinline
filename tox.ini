[tox]
toxworkdir = /tmp/tox/django-staticinline
skip_missing_interpreters = True
envlist =
    readme
    begin
    py{36,37,38,39}-django-{22,31,32}
    end

[gh-actions]
python =
    3.6: py36
    3.7: py37
    3.8: py38
    3.9: py39

[testenv]
usedevelop = True
extras = test
deps =
    django-22: django==2.2.*
    django-31: django==3.1.*
    django-32: django==3.2.*
setenv =
    DJANGO_SETTINGS_MODULE=staticinline.tests.testapp.settings
commands=
    {envbindir}/django-admin collectstatic --noinput -v0
    pytest --cov --cov-append --cov-report= --pdb

[testenv:begin]
basepython = python3.8
skip_install = True
deps = coverage
commands = coverage erase

[testenv:end]
basepython = python3.8
skip_install = True
deps = coverage
commands=
    coverage report --omit="staticinline/tests/*"
    coverage html --omit="staticinline/tests/*" --directory=coverage_report
    coverage report --include="staticinline/tests/*" --fail-under=100

[testenv:readme]
skip_install = True
deps =
    docutils
    Pygments
commands =
    rst2html.py --report=info --halt=warning README.rst /dev/null
    rst2html.py --report=info --halt=warning CHANGELOG.rst /dev/null
